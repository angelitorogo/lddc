

<section class="home">
  <header class="home__header">
    <div>
      <h1 class="home__title">Rutas disponibles</h1>
      <p class="home__subtitle">
        Explora todas rutas. Filtra por distancia, tipo y dificultad.
      </p>
    </div>
  </header>

  
  <!--<div *ngIf="userLocation" class="debug-location">
    üìç Ubicaci√≥n detectada<br />
    <strong>Lat:</strong> {{ userLocation.lat }}<br />
    <strong>Lng:</strong> {{ userLocation.lng }}<br />
    <strong>Fuente:</strong> {{ userLocation.source }}<br />
    <span *ngIf="userLocation.accuracy">
      <strong>Precisi√≥n:</strong> ¬±{{ userLocation.accuracy | number:'1.0-0' }} m
    </span>
  </div>

  <div *ngIf="!userLocation && locationError" class="debug-location error">
    ‚ö†Ô∏è {{ locationError }}
  </div>-->

  <!-- Filtros -->
  <section class="filters">
    <div class="filters__row">
      <!-- === TIPO DE RUTA (custom select) === -->
      <div class="filters__group">
        <label for="routeType">Tipo de ruta</label>
        <div
          class="custom-select"
          [class.custom-select--open]="isRouteTypeOpen"
          (click)="$event.stopPropagation()"
        >
          <button
            type="button"
            class="custom-select__trigger"
            (click)="toggleRouteType()"
          >
            <span>
              {{
                filterRouteType === 'CIRCULAR' ? 'Circular' :
                filterRouteType === 'OUT_AND_BACK' ? 'Ida y vuelta' :
                filterRouteType === 'POINT_TO_POINT' ? 'Lineal' :
                'Todas'
              }}
            </span>
            <i class="bi bi-chevron-down custom-select__icon"></i>
          </button>

          <div class="custom-select__dropdown">
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="!filterRouteType"
              (click)="filterRouteType = ''; closeRouteType()"
            >
              Todas
            </button>

            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterRouteType === 'CIRCULAR'"
              (click)="filterRouteType = 'CIRCULAR'; closeRouteType()"
            >
              Circular
            </button>

            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterRouteType === 'OUT_AND_BACK'"
              (click)="filterRouteType = 'OUT_AND_BACK'; closeRouteType()"
            >
              Ida y vuelta
            </button>

            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterRouteType === 'POINT_TO_POINT'"
              (click)="filterRouteType = 'POINT_TO_POINT'; closeRouteType()"
            >
              Lineal
            </button>
          </div>
        </div>
      </div>

      <!-- === DIFICULTAD (custom select) === -->
      <div class="filters__group">
        <label for="difficulty">Dificultad</label>
        <div
          class="custom-select"
          [class.custom-select--open]="isDifficultyOpen"
          (click)="$event.stopPropagation()"
        >
          <button
            type="button"
            class="custom-select__trigger"
            (click)="toggleDifficulty()"
          >
            <span>
              {{
                filterDifficulty === 'EASY' ? 'F√°cil' :
                filterDifficulty === 'MODERATE' ? 'Moderada' :
                filterDifficulty === 'HARD' ? 'Dif√≠cil' :
                'Todas'
              }}
            </span>
            <i class="bi bi-chevron-down custom-select__icon"></i>
          </button>

          <div class="custom-select__dropdown">
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="!filterDifficulty"
              (click)="filterDifficulty = ''; closeDifficulty()"
            >
              Todas
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterDifficulty === 'EASY'"
              (click)="filterDifficulty = 'EASY'; closeDifficulty()"
            >
              F√°cil
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterDifficulty === 'MODERATE'"
              (click)="filterDifficulty = 'MODERATE'; closeDifficulty()"
            >
              Moderada
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterDifficulty === 'HARD'"
              (click)="filterDifficulty = 'HARD'; closeDifficulty()"
            >
              Dif√≠cil
            </button>
          </div>
        </div>
      </div>

      <!-- === DISTANCIA (inputs num√©ricos) === -->
      <div class="filters__group filters__group--two-inputs">
        <label>Distancia (km)</label>
        <div class="filters__inline-inputs">
          <input
            type="number"
            min="0"
            step="0.5"
            placeholder="m√≠n"
            [(ngModel)]="filterMinDistanceKm"
            name="minDistanceKm"
          />
          <span class="filters__inline-separator">‚Äì</span>
          <input
            type="number"
            min="0"
            step="0.5"
            placeholder="m√°x"
            [(ngModel)]="filterMaxDistanceKm"
            name="maxDistanceKm"
          />
        </div>
      </div>

      <!-- === ORDENAR POR (custom select) === -->
      <div class="filters__group">
        <label for="sortBy">Ordenar por</label>
        <div
          class="custom-select"
          [class.custom-select--open]="isSortByOpen"
          (click)="$event.stopPropagation()"
        >
          <button
            type="button"
            class="custom-select__trigger"
            (click)="toggleSortBy()"
          >
            <span>
              {{
                sortBy === 'distance' ? 'Distancia' :
                sortBy === 'ascent' ? 'Desnivel' :
                sortBy === 'time' ? 'Tiempo' :
                'Fecha'
              }}
            </span>
            <i class="bi bi-chevron-down custom-select__icon"></i>
          </button>

          <div class="custom-select__dropdown">
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortBy === 'date'"
              (click)="sortBy = 'date'; closeSortBy()"
            >
              Fecha
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortBy === 'distance'"
              (click)="sortBy = 'distance'; closeSortBy()"
            >
              Distancia
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortBy === 'ascent'"
              (click)="sortBy = 'ascent'; closeSortBy()"
            >
              Desnivel
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortBy === 'time'"
              (click)="sortBy = 'time'; closeSortBy()"
            >
              Tiempo
            </button>
          </div>
        </div>
      </div>

      <!-- === DIRECCI√ìN (custom select) === -->
      <div class="filters__group">
        <label for="sortOrder">Direcci√≥n</label>
        <div
          class="custom-select"
          [class.custom-select--open]="isSortOrderOpen"
          (click)="$event.stopPropagation()"
        >
          <button
            type="button"
            class="custom-select__trigger"
            (click)="toggleSortOrder()"
          >
            <span>
              {{ sortOrder === 'asc' ? 'Ascendente' : 'Descendente' }}
            </span>
            <i class="bi bi-chevron-down custom-select__icon"></i>
          </button>

          <div class="custom-select__dropdown">
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortOrder === 'desc'"
              (click)="sortOrder = 'desc'; closeSortOrder()"
            >
              Descendente
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortOrder === 'asc'"
              (click)="sortOrder = 'asc'; closeSortOrder()"
            >
              Ascendente
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="filters__actions">
      <button class="btn btn--primary" (click)="onApplyFilters()">
        Aplicar filtros
      </button>
      <button class="btn btn--secondary" (click)="onResetFilters()">
        Limpiar
      </button>
    </div>
  </section>

  <!-- Estado de carga / error -->
  <div *ngIf="loading" class="home__status">
    Cargando rutas...
  </div>

  <div *ngIf="!loading && error" class="home__status home__status--error">
    {{ error }}
  </div>

  <!-- Lista de tracks -->
  <section *ngIf="!loading && !error" class="tracks-list">
    <app-card-track
      *ngFor="let track of tracks; trackBy: trackById"
      [track]="track"
      (openDetail)="onOpenDetailFromHome($event)"
    ></app-card-track>
  </section>

  <div *ngIf="isMobile && loadingMore" class="home__status">
    Cargando m√°s rutas...
  </div>

  <div *ngIf="isMobile && !loading && !error && tracks.length > 0 && !canLoadMore" class="home__status">
    No hay m√°s rutas.
  </div>

  <!-- Paginaci√≥n -->
  <section *ngIf="!isMobile && !loading && !error && tracks.length > 0" class="pagination">
    <button
      class="btn btn--secondary"
      [disabled]="!canGoPrev()"
      (click)="goPrev()"
    >
      ¬´ Anterior
    </button>

    <span class="pagination__info">
      P√°gina {{ page }} de {{ totalPages }} ({{ total }} rutas)
    </span>

    <button
      class="btn btn--secondary"
      [disabled]="!canGoNext()"
      (click)="goNext()"
    >
      Siguiente ¬ª
    </button>
  </section>
</section>

<!-- MODAL DE ERROR -->
<div class="modal-backdrop" *ngIf="showErrorModal">
  <div class="modal">
    <div class="modal-header">
      <h2>Sin resultados</h2>

    </div>
    <div class="modal-body">
      <p>{{ errorMessage }}</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-modal" (click)="closeErrorModal()">
        Entendido
      </button>
    </div>
  </div>
</div>
