
<section class="home">
  <header class="home__header">
    <div>
      <h1 class="home__title">Rutas de {{authService.user?.fullname}}</h1>
      <p class="home__subtitle">
        Explora las rutas del usuario. Filtra por distancia, tipo y dificultad.
      </p>
    </div>
  </header>

  <!-- Filtros -->
  <section class="filters">
    <div class="filters__row">
      <!-- === TIPO DE RUTA (custom select) === -->
      <div class="filters__group">
        <label for="routeType">Tipo de ruta</label>
        <div
          class="custom-select"
          [class.custom-select--open]="isRouteTypeOpen"
          (click)="$event.stopPropagation()"
        >
          <button
            type="button"
            class="custom-select__trigger"
            (click)="toggleRouteType()"
          >
            <span>
              {{
                filterRouteType === 'CIRCULAR' ? 'Circular' :
                filterRouteType === 'OUT_AND_BACK' ? 'Ida y vuelta' :
                filterRouteType === 'POINT_TO_POINT' ? 'Lineal' :
                'Todas'
              }}
            </span>
            <i class="bi bi-chevron-down custom-select__icon"></i>
          </button>

          <div class="custom-select__dropdown">
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="!filterRouteType"
              (click)="filterRouteType = ''; closeRouteType()"
            >
              Todas
            </button>

            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterRouteType === 'CIRCULAR'"
              (click)="filterRouteType = 'CIRCULAR'; closeRouteType()"
            >
              Circular
            </button>

            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterRouteType === 'OUT_AND_BACK'"
              (click)="filterRouteType = 'OUT_AND_BACK'; closeRouteType()"
            >
              Ida y vuelta
            </button>

            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterRouteType === 'POINT_TO_POINT'"
              (click)="filterRouteType = 'POINT_TO_POINT'; closeRouteType()"
            >
              Lineal
            </button>
          </div>
        </div>
      </div>

      <!-- === DIFICULTAD (custom select) === -->
      <div class="filters__group">
        <label for="difficulty">Dificultad</label>
        <div
          class="custom-select"
          [class.custom-select--open]="isDifficultyOpen"
          (click)="$event.stopPropagation()"
        >
          <button
            type="button"
            class="custom-select__trigger"
            (click)="toggleDifficulty()"
          >
            <span>
              {{
                filterDifficulty === 'EASY' ? 'Fácil' :
                filterDifficulty === 'MODERATE' ? 'Moderada' :
                filterDifficulty === 'HARD' ? 'Difícil' :
                'Todas'
              }}
            </span>
            <i class="bi bi-chevron-down custom-select__icon"></i>
          </button>

          <div class="custom-select__dropdown">
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="!filterDifficulty"
              (click)="filterDifficulty = ''; closeDifficulty()"
            >
              Todas
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterDifficulty === 'EASY'"
              (click)="filterDifficulty = 'EASY'; closeDifficulty()"
            >
              Fácil
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterDifficulty === 'MODERATE'"
              (click)="filterDifficulty = 'MODERATE'; closeDifficulty()"
            >
              Moderada
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="filterDifficulty === 'HARD'"
              (click)="filterDifficulty = 'HARD'; closeDifficulty()"
            >
              Difícil
            </button>
          </div>
        </div>
      </div>

      <!-- === DISTANCIA (inputs numéricos) === -->
      <div class="filters__group filters__group--two-inputs">
        <label>Distancia (km)</label>
        <div class="filters__inline-inputs">
          <input
            type="number"
            min="0"
            step="0.5"
            placeholder="mín"
            [(ngModel)]="filterMinDistanceKm"
            name="minDistanceKm"
          />
          <span class="filters__inline-separator">–</span>
          <input
            type="number"
            min="0"
            step="0.5"
            placeholder="máx"
            [(ngModel)]="filterMaxDistanceKm"
            name="maxDistanceKm"
          />
        </div>
      </div>

      <!-- === ORDENAR POR (custom select) === -->
      <div class="filters__group">
        <label for="sortBy">Ordenar por</label>
        <div
          class="custom-select"
          [class.custom-select--open]="isSortByOpen"
          (click)="$event.stopPropagation()"
        >
          <button
            type="button"
            class="custom-select__trigger"
            (click)="toggleSortBy()"
          >
            <span>
              {{
                sortBy === 'distance' ? 'Distancia' :
                sortBy === 'ascent' ? 'Desnivel' :
                sortBy === 'time' ? 'Tiempo' :
                'Fecha'
              }}
            </span>
            <i class="bi bi-chevron-down custom-select__icon"></i>
          </button>

          <div class="custom-select__dropdown">
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortBy === 'date'"
              (click)="sortBy = 'date'; closeSortBy()"
            >
              Fecha
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortBy === 'distance'"
              (click)="sortBy = 'distance'; closeSortBy()"
            >
              Distancia
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortBy === 'ascent'"
              (click)="sortBy = 'ascent'; closeSortBy()"
            >
              Desnivel
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortBy === 'time'"
              (click)="sortBy = 'time'; closeSortBy()"
            >
              Tiempo
            </button>
          </div>
        </div>
      </div>

      <!-- === DIRECCIÓN (custom select) === -->
      <div class="filters__group">
        <label for="sortOrder">Dirección</label>
        <div
          class="custom-select"
          [class.custom-select--open]="isSortOrderOpen"
          (click)="$event.stopPropagation()"
        >
          <button
            type="button"
            class="custom-select__trigger"
            (click)="toggleSortOrder()"
          >
            <span>
              {{ sortOrder === 'asc' ? 'Ascendente' : 'Descendente' }}
            </span>
            <i class="bi bi-chevron-down custom-select__icon"></i>
          </button>

          <div class="custom-select__dropdown">
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortOrder === 'desc'"
              (click)="sortOrder = 'desc'; closeSortOrder()"
            >
              Descendente
            </button>
            <button
              type="button"
              class="custom-select__option"
              [class.custom-select__option--active]="sortOrder === 'asc'"
              (click)="sortOrder = 'asc'; closeSortOrder()"
            >
              Ascendente
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="filters__actions">
      <button class="btn btn--primary" (click)="onApplyFilters()">
        Aplicar filtros
      </button>
      <button class="btn btn--secondary" (click)="onResetFilters()">
        Limpiar
      </button>
    </div>
  </section>

  <!-- Estado de carga / error -->
  <div *ngIf="loading" class="home__status">
    Cargando rutas...
  </div>

  <div *ngIf="!loading && error" class="home__status home__status--error">
    {{ error }}
  </div>

  <!-- Lista de tracks -->
  <section *ngIf="!loading && !error" class="tracks-list">
    <app-card-track
      *ngFor="let track of tracks; trackBy: trackById"
      [track]="track"
    ></app-card-track>
  </section>

  <div *ngIf="isMobile && loadingMore" class="home__status">
    Cargando más rutas...
  </div>

  <div *ngIf="isMobile && !loading && !error && tracks.length > 0 && !canLoadMore" class="home__status">
    No hay más rutas.
  </div>

  <!-- Paginación -->
  <section *ngIf="!isMobile && !loading && !error && tracks.length > 0" class="pagination">
    <button
      class="btn btn--secondary"
      [disabled]="!canGoPrev()"
      (click)="goPrev()"
    >
      « Anterior
    </button>

    <span class="pagination__info">
      Página {{ page }} de {{ totalPages }} ({{ total }} rutas)
    </span>

    <button
      class="btn btn--secondary"
      [disabled]="!canGoNext()"
      (click)="goNext()"
    >
      Siguiente »
    </button>
  </section>
</section>

<!-- MODAL DE ERROR -->
<div class="modal-backdrop" *ngIf="showErrorModal">
  <div class="modal">
    <div class="modal-header">
      <h2>Sin resultados</h2>

    </div>
    <div class="modal-body">
      <p>{{ errorMessage }}</p>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-modal" (click)="closeErrorModal()">
        Entendido
      </button>
    </div>
  </div>
</div>
